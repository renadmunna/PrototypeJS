<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>LibJS</title><script src="../src/dev.js"></script>
	<script src="../dist/lib.js"></script>
</head>
<body>
<div><textarea class="textarea" cols="30" rows="10"></textarea></div>
<button class="open_file">Open File</button>
<button class="save">Save</button>
<button class="save_as">Save As</button>
<button class="open_folder">Open Folder</button>
<script>

async function openInTextArea(fileHandle){
	const file = await fileHandle.getFile();
	const contents = await file.text();
	$('.textarea').value = contents;
}
var fileHandle;
$('.open_file').on('click',async function(){
	[fileHandle] = await window.showOpenFilePicker({types:[
		{description:"HTML files",accept:{"text/html":[".html"]}},
		{description:"Test files",accept:{"text/plain":[".txt"]}},
	]});
	// const file = await fileHandle.getFile();
	// const contents = await file.text();
	// $('.textarea').value = contents;
	openInTextArea(fileHandle);
});
async function save(){
	if(!fileHandle){return}
	const writable = await fileHandle.createWritable();
	await writable.write($('.textarea').value);
	await writable.close();
}
$(".save").on('click',save);
$(".save_as").on('click',async function(){
	if(!fileHandle){return}
	fileHandle = await window.showSaveFilePicker({types:[
		{description:"HTML files",accept:{"text/html":[".html"]}},
		{description:"Test files",accept:{"text/plain":[".txt"]}},
	]});
	save();
});

$('.open_folder').on('click',async function(){
	const directoryHandle = await window.showDirectoryPicker();
	// for await (const entry of directoryHandle.values()) {
	// 	console.log(entry.kind, entry.name, entry);
	// 	if(entry.kind=='directory'){

	// 	}
	// 	if(entry.name=='0file.txt'){
	// 		openInTextArea(entry);
	// 	}
	// }
	dir_loop(directoryHandle);

});
async function dir_loop(directoryHandle){
	for await (const entry of directoryHandle.values()) {
		console.log(entry.kind, entry.name);
		if(entry.kind=='directory'){
			dir_loop(entry);
		}
	}
}

// // delete
// // file
// document.querySelector(".pick-file").onclick = async () => {
//  const [fileHandle] = await window.showOpenFilePicker();
//  await fileHandle.remove();
// };
// // folder
// document.querySelector(".read-dir").onclick = async () => {
//  const directoryHandle = await window.showDirectoryPicker();
//  await directoryHandle.remove();
// };
// // Delete a single file named data.txt in the selected folder
// document.querySelector(".pick-folder").onclick = async () => {
//    const directoryHandle = await window.showDirectoryPicker();
//    await directoryHandle.removeEntry("data.txt");
// };
// // Recursively delete the folder named "data"
// document.querySelector(".pick-folder").onclick = async () => {
//    const directoryHandle = await window.showDirectoryPicker();
//    await directoryHandle.removeEntry('data', { recursive: true });
// };
</script>
</body>
</html>